using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Security;
using System.Security.Cryptography;

namespace DESTesting
{
	class Program
	{
		static void Main(string[] args)
		{
			Security.TripleDES tdes = new Security.TripleDES();

			byte[] data = new byte[64];

			byte[] result = new byte[64];

			for (int i = 0; i < 64; i++)
			{
				data[i] = (byte)i;
			}

			//byte[] key = new byte[8];

			//for (int i = 0; i < 8; i++)
			//{
			//	key[i] = (byte)i;
			//}

			// moraju malo jaci kljucevi
			string tempkey = "secret key123456";
			byte[] keyArray = UTF8Encoding.UTF8.GetBytes(tempkey);

			byte[] IVconst = UTF8Encoding.UTF8.GetBytes("initiali");

			byte[] key1 = new byte[8];
			byte[] key2 = new byte[8];

			Array.Copy(keyArray, 0, key1, 0, 8);
			Array.Copy(keyArray, 8, key2, 0, 8);

			byte[] encdata = new byte[64];

			result = tdes.encrypt(data, key1, key2, IVconst);
			Console.WriteLine("Homemade triple DES encrypted text:");
			Console.WriteLine(Convert.ToBase64String(result, 0, result.Length));


			//byte[] decryptedData = new byte[64];

			//decryptedData = tdes.decrypt(result, key1, key2, IVconst);


			//Sada ide enkripcija C# tripleDES algoritmom**************************************************************

			TripleDESCryptoServiceProvider cSharptdes = new TripleDESCryptoServiceProvider();
			//cSharptdes.Key

			cSharptdes.Mode = CipherMode.CBC;
			cSharptdes.Padding = PaddingMode.None;
			cSharptdes.KeySize = 128;
			//treba napraviti prvo kljuceve za triple des
			byte[] keysForThis = new byte[16];
			Array.Copy(key1, 0, keysForThis, 0, 8);
			Array.Copy(key2, 0, keysForThis, 8, 8);

			cSharptdes.Key = keyArray;

			cSharptdes.IV = IVconst;

			ICryptoTransform cTransform = cSharptdes.CreateEncryptor();
			//transform the specified region of bytes array to resultArray

			byte[] resultArray = cTransform.TransformFinalBlock(data, 0, data.Length);

			//Release resources held by TripleDes Encryptor
			cSharptdes.Clear();

			Console.WriteLine("\nC# triple DES encrypted text:");
			Console.WriteLine(Convert.ToBase64String(resultArray, 0, resultArray.Length));


		}
	}
}
